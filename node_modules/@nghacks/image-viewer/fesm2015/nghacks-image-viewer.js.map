{"version":3,"file":"nghacks-image-viewer.js","sources":["../../../projects/image-viewer/src/lib/components/image-viewer/image-viewer.component.ts","../../../projects/image-viewer/src/lib/directives/image-viewer.directive.ts","../../../projects/image-viewer/src/lib/image-viewer.module.ts","../../../projects/image-viewer/src/public-api.ts","../../../projects/image-viewer/src/nghacks-image-viewer.ts"],"sourcesContent":["import { isPlatformBrowser } from '@angular/common';\nimport { Component, HostListener, Inject, OnDestroy, OnInit, PLATFORM_ID } from '@angular/core';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { Subject } from 'rxjs';\nimport { takeUntil } from 'rxjs/operators';\nimport { DOCUMENT } from '@angular/common';\n\nexport class ImageDimension {\n  public width: number;\n  public height: number;\n\n  constructor(width = 0, height = 0) {\n    this.height = height;\n    this.width = width;\n  }\n}\n\nexport interface ImageViewerDialogData { src: string; alt: string; }\n\n@Component({\n  selector: 'lib-image-viewer',\n  templateUrl: './image-viewer.component.html',\n  styleUrls: ['./image-viewer.component.scss']\n})\nexport class ImageViewerComponent implements OnInit, OnDestroy {\n\n  src: string;\n  alt: string;\n\n  calculatedImageDimension: ImageDimension;\n  imageLoaded: boolean;\n  hideCloseBtn: boolean;\n\n  private _originalImageDimension: ImageDimension;\n  private _unsubscribeAll: Subject<any> = new Subject();\n  private _document: Document;\n\n  constructor(\n    @Inject(DOCUMENT) private _nativeDocument: any,\n    @Inject(MAT_DIALOG_DATA) private _data: ImageViewerDialogData,\n    @Inject(PLATFORM_ID) private _platformId: any,\n    private _dialogRef: MatDialogRef<ImageViewerComponent>,\n  ) {\n    this._document = this._nativeDocument as Document;\n  }\n\n  async ngOnInit(): Promise<void> {\n    this._originalImageDimension = await this.getOriginalImageDimension(this._data.src);\n    this.setImageDimension();\n    this.src = this._data.src;\n    this.alt = this._data.alt;\n    this.imageLoaded = true;\n\n    // hide the close button before dialog close\n    // Otherwise it apears inside image\n    this._dialogRef.beforeClosed()\n      .pipe(\n        takeUntil(this._unsubscribeAll)\n      )\n      .subscribe(res => {\n        this.hideCloseBtn = true;\n      });\n  }\n\n  @HostListener('window:resize', ['$event'])\n  private setImageDimension(): void {\n\n    if (!isPlatformBrowser(this._platformId)) { return; }\n\n    const windowDimension = new ImageDimension(\n      this.percentage(this._document.body.clientWidth, 90),\n      this.percentage(this._document.body.clientHeight, 90)\n    );\n    this.calculatedImageDimension = this.calculateAspectRatioFit(this._originalImageDimension, windowDimension);\n  }\n\n  private calculateAspectRatioFit(srcDimension: ImageDimension, maxDimension: ImageDimension): ImageDimension {\n    if (srcDimension.height <= maxDimension.height && srcDimension.width <= maxDimension.width) {\n      return srcDimension;\n    }\n    const ratio = Math.min(maxDimension.width / srcDimension.width, maxDimension.height / srcDimension.height);\n    return new ImageDimension(srcDimension.width * ratio, srcDimension.height * ratio);\n  }\n\n  private getOriginalImageDimension(imageUrl: string): Promise<ImageDimension> {\n\n    if (!imageUrl) { return; }\n\n    return new Promise(res => {\n      const img = new Image();\n      img.onload = (event) => {\n        const loadedImage: any = event.currentTarget;\n        const dimension = new ImageDimension(loadedImage.width, loadedImage.height);\n        return res(dimension);\n      };\n      img.src = imageUrl;\n\n    });\n  }\n\n  private percentage(total: number, percent: number): number {\n    return ((percent / 100) * total);\n  }\n\n  public ngOnDestroy(): void {\n    this._unsubscribeAll.next();\n    this._unsubscribeAll.complete();\n  }\n\n\n}\n","import { Directive, ElementRef, HostBinding, HostListener, Input } from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\nimport { ImageViewerComponent } from '../components/image-viewer/image-viewer.component';\n\n@Directive({\n  selector: '[imageViewer]'\n})\nexport class ImageViewerDirective {\n\n  @HostBinding('style.cursor') private _cursor;\n\n  /**\n   * @description Image source URL\n   */\n  @Input() src: string;\n\n  /**\n   * @description Alnernate text for image\n   */\n  @Input() alt: string;\n\n  private _disabled: boolean;\n\n  /**\n   * @description Disables image viewer\n   */\n  @Input('disabled')\n  public set disabled(v: boolean) {\n    this._disabled = v;\n    if (v) {\n      this._cursor = 'initial';\n    }\n  }\n\n  private _customSrc: string;\n\n  @Input('imageViewer')\n  public set customSrc(v: string) {\n    if (!v) { return; }\n    this._customSrc = v;\n  }\n\n  constructor(\n    private _elRef: ElementRef,\n    private _dialog: MatDialog\n  ) {\n    if (this._elRef.nativeElement.tagName === 'IMG') {\n      this._cursor = 'zoom-in';\n    }\n  }\n\n\n  @HostListener('click')\n  public viewImage(): void {\n\n    if (this._disabled) { return; }\n\n    this._dialog.open(\n      ImageViewerComponent,\n      {\n        autoFocus: false,\n        data: {\n          src: this._customSrc || this.src,\n          alt: this.alt\n        },\n        panelClass: 'ng-hacks-image-viewer',\n        backdropClass: 'ng-hacks-image-viewer-backdrop'\n      }\n    );\n  }\n\n\n}\n","import { NgModule } from '@angular/core';\nimport { ImageViewerComponent } from './components/image-viewer/image-viewer.component';\nimport { ImageViewerDirective } from './directives/image-viewer.directive';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { CommonModule } from '@angular/common';\nimport { MatProgressSpinnerModule } from '@angular/material/progress-spinner';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\n\n@NgModule({\n  declarations: [\n    ImageViewerComponent,\n    ImageViewerDirective\n  ],\n  imports: [\n    CommonModule,\n    MatDialogModule,\n    MatProgressSpinnerModule,\n    MatButtonModule,\n    MatIconModule\n  ],\n  exports: [\n    ImageViewerDirective\n  ]\n})\nexport class ImageViewerModule { }\n","/*\n * Public API Surface of image-viewer\n */\n\n// export * from './lib/components/image-viewer/image-viewer.component';\nexport * from './lib/directives/image-viewer.directive';\nexport * from './lib/image-viewer.module';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n\nexport {ImageViewerComponent as Éµa} from './lib/components/image-viewer/image-viewer.component';"],"names":[],"mappings":"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"}